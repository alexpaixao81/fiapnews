<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiap News</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>

    <%- include('./partials/navbar') %>

        <!-- Barra de Pesquisa -->
        <div class="container my-4">
            <input type="text" id="searchBar" class="form-control" placeholder="ðŸ”Ž Buscar notÃ­cias...">
        </div>

        <!-- ==================== CARROSSEL 1 ==================== -->
        <div id="carouselNoticias1" class="carousel slide container mb-4" data-bs-ride="carousel">
            <div class="row align-items-start">
                <!-- Carrossel Principal -->
                <div class="col-md-5 position-relative">
                    <div class="carousel-inner">
                        <% news.slice(0, 5).forEach((item, index)=> { %>
                            <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                                <a href="/news/view/<%= item.id %>" class="text-decoration-none">
                                    <img src="<%= item.image.startsWith('http') ? item.image : '/images/' + item.image %>"
                                        class="d-block w-100 rounded main-news-image" alt="<%= item.title %>">
                                    <div
                                        class="carousel-caption d-flex flex-column align-items-start bg-dark bg-opacity-75 p-2 rounded">
                                        <span class="badge bg-warning text-dark">TÃ³pico</span>
                                        <h6 class="fw-bold text-white mt-2">
                                            <%= item.title %>
                                        </h6>
                                    </div>
                                </a>
                            </div>
                            <% }); %>
                    </div>

                    <!-- BotÃµes de NavegaÃ§Ã£o -->
                    <button class="carousel-control-prev visible-control" type="button"
                        data-bs-target="#carouselNoticias1" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon custom-icon" aria-hidden="true"></span>
                    </button>
                    <button class="carousel-control-next visible-control" type="button"
                        data-bs-target="#carouselNoticias1" data-bs-slide="next">
                        <span class="carousel-control-next-icon custom-icon" aria-hidden="true"></span>
                    </button>
                </div>

                <!-- Lista de Miniaturas -->
                <div class="col-md-7 d-flex flex-column">
                    <div class="list-group w-100 h-100">
                        <% news.slice(0, 4).forEach((item)=> { %>
                            <a href="/news/view/<%= item.id %>"
                                class="list-group-item list-group-item-action d-flex align-items-center">
                                <img src="<%= item.image.startsWith('http') ? item.image : '/images/carousel/' + item.image %>"
                                    class="rounded thumb-news" alt="<%= item.title %>">
                                <div class="ms-2 flex-grow-1">
                                    <h6 class="mb-1 text-dark fw-bold">
                                        <%= item.title %>
                                    </h6>
                                    <h6 class="mb-1 text-dark fw-bold">
                                        <%= item.short_description %>
                                    </h6>
                                </div>
                            </a>
                            <% }); %>
                    </div>
                </div>
            </div>
        </div>



        <!-- SeÃ§Ã£o de NotÃ­cias -->
        <div class="container">
            <div class="row" id="newsContainer">
                <% news.forEach((item)=> { %>
                    <div class="col-md-4 mb-4 news-card">
                        <div class="card" data-title="<%= item.title.toLowerCase() %>">
                            <img src="<%= item.image.startsWith('http') ? item.image : '/images/' + item.image %>">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <%= item.title %>
                                </h5>
                                <a href="/news/view/<%= item.id %>" class="btn btn-primary">Leia mais</a>
                                <span class="float-end">Visitas: <%= item.views %></span>
                            </div>
                        </div>
                    </div>
                    <% }); %>
            </div>
        </div>

        <!-- ==================== CARROSSEL 2 ==================== -->
        <div id="carouselNoticias2" class="carousel slide container mb-4" data-bs-ride="carousel">

            <div class="row align-items-start">
                <!-- Carrossel Principal -->
                <div class="col-md-5 position-relative">
                    <div class="carousel-inner">
                        <% news.slice(0, 5).forEach((item, index)=> { %>
                            <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                                <a href="/news/view/<%= item.id %>" class="text-decoration-none">
                                    <img src="<%= item.image.startsWith('http') ? item.image : '/images/' + item.image %>"
                                        class="d-block w-100 rounded main-news-image" alt="<%= item.title %>">
                                    <div
                                        class="carousel-caption d-flex flex-column align-items-start bg-dark bg-opacity-75 p-2 rounded">
                                        <span class="badge bg-warning text-dark">TÃ³pico</span>
                                        <h6 class="fw-bold text-white mt-2">
                                            <%= item.title %>
                                        </h6>
                                    </div>
                                </a>
                            </div>
                            <% }); %>
                    </div>

                    <!-- BotÃµes de NavegaÃ§Ã£o -->
                    <button class="carousel-control-prev visible-control" type="button"
                        data-bs-target="#carouselNoticias2" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon custom-icon" aria-hidden="true"></span>
                    </button>
                    <button class="carousel-control-next visible-control" type="button"
                        data-bs-target="#carouselNoticias2" data-bs-slide="next">
                        <span class="carousel-control-next-icon custom-icon" aria-hidden="true"></span>
                    </button>
                </div>

                <!-- Lista de Miniaturas -->
                <div class="col-md-7 d-flex flex-column">
                    <div class="list-group w-100 h-100">
                        <% news.slice(0, 4).forEach((item)=> { %>
                            <a href="/news/view/<%= item.id %>"
                                class="list-group-item list-group-item-action d-flex align-items-center">
                                <img src="<%= item.image.startsWith('http') ? item.image : '/images/carousel/' + item.image %>"
                                    class="rounded thumb-news" alt="<%= item.title %>">
                                <div class="ms-2 flex-grow-1">
                                    <h6 class="mb-1 text-dark fw-bold">
                                        <%= item.title %>
                                    </h6>
                                    <h6 class="mb-1 text-dark fw-bold">
                                        <%= item.short_description %>
                                    </h6>
                                </div>
                            </a>
                            <% }); %>
                    </div>
                </div>
            </div>
        </div>


        <!-- NotÃ­cias em Alta -->
        <div class="container my-4">
            <h2 class="text-center text-danger">ðŸ”¥ NotÃ­cias em Destaque</h2>
            <ul class="list-group list-group-flush">
                <% news.sort((a, b)=> b.views - a.views).slice(0, 5).forEach((item) => { %>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <a href="/news/view/<%= item.id %>" class="text-decoration-none fw-bold">
                            <%= item.title %>
                        </a>
                        <span class="badge bg-danger rounded-pill">
                            <%= item.views %> ðŸ‘€
                        </span>
                    </li>
                    <% }); %>
            </ul>
        </div>

        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- InicializaÃ§Ã£o dos carrossÃ©is -->
        <script>
            // Inicializa os carrossÃ©is corretamente
            var carousel1 = new bootstrap.Carousel(document.querySelector('#carouselNoticias1'), {
                interval: 5000,
                wrap: true
            });

            var carousel2 = new bootstrap.Carousel(document.querySelector('#carouselNoticias2'), {
                interval: 5000,
                wrap: true
            });

            // Barra de Pesquisa
            document.getElementById("searchBar").addEventListener("input", function () {
                let filter = this.value.toLowerCase();
                let newsCards = document.querySelectorAll(".news-card");
                newsCards.forEach(card => {
                    let title = card.querySelector(".card-title").innerText.toLowerCase();
                    card.style.display = title.includes(filter) ? "block" : "none";
                });
            });
        </script>

</body>

</html>